@model Trakt.Models.SerieDetailsViewModel

@{
   ViewBag.Title = Model.Serie.Naam;
}

<h2>@ViewBag.Title</h2>
<hr />

@{
   List<int> seizoenen = new List<int>();
   foreach (var aflevering in Model.Serie.Afleveringen)
   {
      if (!seizoenen.Contains(aflevering.Seizoen))
      {
         seizoenen.Add(aflevering.Seizoen);
      }
   }
}
<div class="row">
   <div class="col-md-4" style="padding-right: 20px;border-right:solid 1px">
      @{
         var source = "";
         if (Model.Serie.PosterPath == null)
         {
            source = "/Content/Images/no_image.png";
         }
         else
         {
            source = Model.Serie.PosterPath;
         }
      }
      <img src="@source" class="image" alt="Poster @Model.Serie.Naam" style="width:100%;" />
   </div>
   <div class="col-md-8" style="padding-left: 20px;">
      <img alt="Banner @Model.Serie.Naam" style="width:100%" src="@Model.Serie.BannerPath" />
      <hr />
      <p><strong>Omschrijving</strong></p>
      <p>@Model.Serie.Omschrijving</p>
      <br />
      <p class="col-sm-4" style="text-align:center"><strong>@seizoenen.Count Seizoenen</strong></p>
      <p class="col-sm-4" style="text-align:center"><strong>@Model.Serie.AirDate</strong></p>
      <p class="col-sm-4" style="text-align:center"><strong>@Model.Serie.Netwerk</strong></p>
   </div>
</div>


<div class="testimonial-group">
   <h2>Acteurs</h2>
   <div class="row">
      @{
         Model.Serie.Acteurs.Sort((a1, a2) => a1.Sort.CompareTo(a2.Sort));
      }
      @foreach (var acteur in Model.Serie.Acteurs)
      {
         <div class="col-md-3 col-sm-6 col-xs-12 poster">
            @{ 
                var url = Url.Action("DetailsAndere", "Acteurs", new { id = acteur.ActeurID });
                if (Model.IsActeurInDb(acteur.ActeurID))
                {
                   url = Url.Action("Details", "Acteurs", new { id = acteur.ActeurID });
                }
            }
            <a href="@url" title="@acteur.Acteur.Naam">
               @{
                  var actSrc = "";
                  var posterClass = "poster";
                  var overlayClass = "overlayPoster";

                  if (acteur.Acteur.ImagePath == null)
                  {
                     source = "/Content/Images/no_image.png";
                     posterClass += " posterhovered";
                     overlayClass += " overlayhovered";
                  }
                  else
                  {
                     if (acteur.Acteur.ImagePath.StartsWith("http"))
                     {
                        actSrc = acteur.Acteur.ImagePath;
                     }
                     else
                     {
                        actSrc = "https://image.tmdb.org/t/p/w300/" + acteur.Acteur.ImagePath;
                     }
                  }
               }
               <img src="@actSrc" class="image" onerror="setNoImage(this);" alt="@acteur.Acteur.Naam" style="max-width:100%; height:400px" />
               <div class="overlayPoster">
                  <div class="posterOverlayContent">@acteur.Acteur.Naam<br />@acteur.Karakter</div>
               </div>
            </a>
         </div>
      }
   </div>
</div>

<div class="panel-group" id="seizoenen" style="margin-top:15px;">
   @{ 
       seizoenen.Sort();
       int count = 0;
   }
   @foreach (var seizoen in seizoenen)
   {

      var afleveringen = Model.Serie.Afleveringen.Where(a => a.Seizoen == seizoen).ToList();
      afleveringen.Sort((a1, a2) => a1.Nummer.CompareTo(a2.Nummer));

      <div class="panel panel-default">
         <div class="panel-heading">
            <h4 class="panel-title">
               <a data-toggle="collapse" data-parent="#seizoenen" href="#seizoen-@seizoen">
                  Seizoen @seizoen <span class="badge" style="float:right;">#@afleveringen.Count</span>
               </a>
            </h4>
         </div>
         <div id="seizoen-@seizoen" class="panel-collapse collapse">
            <div class="panel-body">
               <div class="testimonial-group">
                  <div class="row">
                     @foreach (var aflevering in afleveringen)
                     {
                        <div class="col-md-3 col-sm-6 col-xs-12 poster">
                           <a href="@Url.Action("Details", "Aflevering", new { id = aflevering.ID })" title="@aflevering.Naam">
                              @{
                                 var actSrc = "";
                                 var posterClass = "poster";
                                 var overlayClass = "overlayPoster";

                                 if (aflevering.ImagePath == null)
                                 {
                                    source = "/Content/Images/no_image.png";
                                    posterClass += " posterhovered";
                                    overlayClass += " overlayhovered";
                                 }
                                 else
                                 {
                                    actSrc = aflevering.ImagePath;
                                 }
                              }
                              <img src="@actSrc" class="image" onerror="setNoImage(this);" alt="@aflevering.Naam" style="width:100%;max-height:140px" />
                              <div class="overlayPoster" style="transition:none; opacity:1;">
                                 <div class="posterOverlayContent">@aflevering.Naam<br />Afl. @aflevering.Nummer</div>
                              </div>
                           </a>
                        </div>
                     }
                  </div>
               </div>
            </div>
         </div>
      </div>
   }
</div>

@*@foreach (var seizoen in seizoenen)
   {
      <div class="testimonial-group">
         <h1>Seizoen @seizoen</h1>
         <div class="row">
            @{
               var afleveringen = Model.Afleveringen.Where(a => a.Seizoen == seizoen).ToList();
               afleveringen.Sort((a1, a2) => a1.Nummer.CompareTo(a2.Nummer));
            }
            @foreach (var aflevering in afleveringen)
            {
               <div class="col-md-3 col-sm-6 col-xs-12 poster">
                  <a href="@Url.Action("Details", "Aflevering", new { id = aflevering.ID })" title="@aflevering.Naam">
                     @{
                        var actSrc = "";
                        var posterClass = "poster";
                        var overlayClass = "overlayPoster";

                        if (aflevering.ImagePath == null)
                        {
                           source = "/Content/Images/no_image.png";
                           posterClass += " posterhovered";
                           overlayClass += " overlayhovered";
                        }
                        else
                        {
                           actSrc = aflevering.ImagePath;
                        }
                     }
                     <img src="@actSrc" class="image" onerror="setNoImage(this);" alt="@aflevering.Naam" style="width:100%;" />
                     <div class="overlayPoster">
                        <div class="posterOverlayContent">@aflevering.Naam<br />Afl. @aflevering.Nummer</div>
                     </div>
                  </a>
               </div>
            }
         </div>
      </div>
   }*@



<script>
   function setNoImage(element) {
      element.src = "/Content/Images/no_image.png";
   }
</script>